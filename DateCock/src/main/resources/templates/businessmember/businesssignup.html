<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Sign Up</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <!-- âœ… CSRF í† í° ë©”íƒ€ íƒœê·¸ ì¶”ê°€ -->
    <meta name="_csrf" th:content="${_csrf.token}" />
    <meta name="_csrf_header" th:content="${_csrf.headerName}" />

    <script type="text/javascript">
        $(document).ready(function () {

            var isPasswordMatch = false;
            var isbncAndAvailable = false;
            var isPasswordFormatValid = false;

            // âœ… ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ ì¤‘ë³µ í™•ì¸
            $("#businessnumbercheck").click(function () {
                console.log("ğŸ’¥ ì¤‘ë³µí™•ì¸ ë²„íŠ¼ í´ë¦­ë¨");
                var businessnumber = $("#businessnumber").val();
                if (!businessnumber) {
                    alert("ì‚¬ì—…ì ë“±ë¡ ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                    $("#businessnumber").focus();
                    return;
                }

                // âœ… CSRF í† í° ë™ì  ì‚½ì…
                const token = document.querySelector('meta[name="_csrf"]').content;
                const header = document.querySelector('meta[name="_csrf_header"]').content;

                $.ajax({
                    type: "POST",
                    url: "/businessnumbercheck2",
                    data: { businessnumber: businessnumber },
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader(header, token);
                    },
                    success: function (response) {
                        if (response === "yes") {
                            alert("ì‚¬ìš© ê°€ëŠ¥í•œ ì‚¬ì—…ìë²ˆí˜¸ì…ë‹ˆë‹¤.");
                            isbncAndAvailable = true;
                        } else {
                            alert("ì´ë¯¸ ì‚¬ìš© ì¤‘ì´ê±°ë‚˜ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                            isbncAndAvailable = false;
                        }
                    },
                    error: function (xhr) {
                        alert("ì„œë²„ ìš”ì²­ ì‹¤íŒ¨: " + xhr.status);
                    }
                });
            });

            $("#businessnumber").on('keyup', function () {
                isbncAndAvailable = false;
            });

            // âœ… ë¹„ë°€ë²ˆí˜¸ í˜•ì‹ ê²€ì‚¬
            $("#password").on('keyup', function () {
                var num = $(this).val();
                var messageSpan = $("#pwd_rule_msg2");
                var specialCharRegex = /[!@#$%^&*(),.?":{}|<>]/;

                if (num.length == 0) {
                    messageSpan.hide();
                    isPasswordFormatValid = false;
                } else if (specialCharRegex.test(num)) {
                    messageSpan.text("ì‚¬ìš© ê°€ëŠ¥í•œ ë¹„ë°€ë²ˆí˜¸ í˜•ì‹ì…ë‹ˆë‹¤").css("color", "green").show();
                    isPasswordFormatValid = true;
                } else {
                    messageSpan.text("ë¹„ë°€ë²ˆí˜¸ì— íŠ¹ìˆ˜ë¬¸ì(!@#$%^&* ë“±)ì„ 1ê°œì´ìƒ í¬í•¨í•´ì•¼í•©ë‹ˆë‹¤.").css("color", "red").show();
                    isPasswordFormatValid = false;
                }
                $("#password_confirm").trigger('keyup');
            });

            // âœ… ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ í™•ì¸
            $("#password, #password_confirm").on('keyup', function () {
                var pwd = $("#password").val();
                var pwdConfirm = $("#password_confirm").val();
                var messageSpan = $("#password_confirm_msg");

                if (pwd || pwdConfirm) {
                    if (pwd === pwdConfirm && pwd !== "") {
                        messageSpan.text("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.").css("color", "green");
                        isPasswordMatch = true;
                    } else {
                        messageSpan.text("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.").css("color", "red");
                        isPasswordMatch = false;
                    }
                    messageSpan.show();
                } else {
                    messageSpan.hide();
                    isPasswordMatch = false;
                }
            });

            // âœ… ìµœì¢… ì œì¶œ ê²€ì‚¬
            $("#signupForm").on('submit', function (event) {
                if (!isbncAndAvailable) {
                    alert("ì‚¬ì—…ì ë“±ë¡ ë²ˆí˜¸ ì¤‘ë³µí™•ì¸ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.");
                    event.preventDefault();
                    $('#businessnumber').focus();
                    return false;
                }
                if (!isPasswordMatch) {
                    alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                    event.preventDefault();
                    return false;
                }
                if (!isPasswordFormatValid) {
                    alert("ë¹„ë°€ë²ˆí˜¸ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                    event.preventDefault();
                    $("#password").focus();
                    return false;
                }
                return true;
            });

        });
    </script>

    <style type="text/css">
        .recommend-wrapper {
            background: url("[[@{/image/ivent1.png}]]") no-repeat center center fixed;
            background-size: cover;
            min-height: 100vh;
            padding: 60px 0;
        }

        .error-message {
            font-size: 12px;
            margin-top: 5px;
        }

        .custom-link {
            color: gray;
            text-decoration: underline;
            font-size: 15px;
            display: inline-block;
            margin-top: 10px;
        }

        .custom-link:hover {
            color: #555;
        }
    </style>
</head>

<body>

<!-- ì„±ê³µ/ì‹¤íŒ¨ ë©”ì‹œì§€ alert -->
<script th:if="${successMessage != null}">
    alert([[${successMessage}]]);
</script>
<script th:if="${errorMessage != null}">
    alert([[${errorMessage}]]);
</script>

<div class="recommend-wrapper">
    <div class="login-wrap">
        <div class="login-html">
            <input id="tab-1" type="radio" name="tab" class="sign-in" checked><label for="tab-1" class="tab">Sign In</label>
            <input id="tab-2" type="radio" name="tab" class="sign-up"><label for="tab-2" class="tab">Sign Up</label>
            <div class="login-form">

                <!-- ë¡œê·¸ì¸ Form -->
                <form th:action="@{/loginprocess}" method="post">
                    <div class="sign-in-htm">
                        <div class="group">
                            <label for="businessnumberA" class="label">ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸</label>
                            <input id="businessnumberA" type="text" name="loginId" class="input">
                        </div>

                        <div class="group">
                            <label for="businesspwA" class="label">ë¹„ë°€ë²ˆí˜¸</label>
                            <input id="businesspwA" type="password" name="loginPw" class="input" data-type="password">
                        </div>

                        <div class="group">
                            <input type="submit" class="button" value="ë¡œê·¸ì¸">
                        </div>

                        <div class="group">
                            <button type="button" class="button" th:onclick="|location.href='@{/main}'|">ì·¨ì†Œ</button>
                        </div>

                        <div class="group center-link">
                            <a class="custom-link" th:href="@{/businessresult}">ì‚¬ì—…ì ë²ˆí˜¸, ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¥¼ ìŠì–´ë²„ë¦¬ì…¨ë‚˜ìš”?</a>
                        </div>

                        <div class="logo-area" style="text-align: center; margin-top: 30px; margin-bottom: 20px;">
                            <img th:src="@{/image/DateCocklogo.png}" alt="DATECOCK ë¡œê³ " style="max-width: 250px; height: auto;">
                        </div>
                    </div>
                </form>

                <!-- íšŒì›ê°€ì… Form -->
                <form id="signupForm" th:action="@{/businessmembersave}" method="post">
                    <div class="sign-up-htm">

                        <div class="group">
                            <label for="businessnumber" class="label">ì‚¬ì—…ì ë“±ë¡ ë²ˆí˜¸</label>
                            <input id="businessnumber" type="text" class="input" name="businessnumber"
                                   placeholder="-ë¥¼ ì œì™¸í•œ ë²ˆí˜¸(10ìë¦¬) ì…ë ¥í•´ì£¼ì„¸ìš”. ex)0123456789 " maxlength="20">
                            <button type="button" id="businessnumbercheck" class="button"
                                    style="margin-top: 10px; width: auto; padding: 5px 10px;">ì¤‘ë³µ í™•ì¸</button>
                            <div class="error-message" id="numberErrorMessage"></div>
                        </div>

                        <div class="group">
                            <label for="password" class="label">ë¹„ë°€ë²ˆí˜¸</label>
                            <input id="password" type="password" class="input" name="password"
                                   placeholder="ë¹„ë°€ë²ˆí˜¸" maxlength="20">
                            <span id="pwd_rule_msg2" class="error-message"></span>
                        </div>

                        <div class="group">
                            <label for="password_confirm" class="label">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                            <input id="password_confirm" type="password" class="input" name="password_confirm"
                                   placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" maxlength="20">
                            <span id="password_confirm_msg" class="error-message"></span>
                            <div class="error-message" id="passwordErrorMessage"></div>
                        </div>

                        <div class="group">
                            <label for="email" class="label">Email ì£¼ì†Œ</label>
                            <input id="email" type="text" class="input" name="email" placeholder="ì´ë©”ì¼ ex)user@datecock.com">
                        </div>

                        <div class="group">
                            <label for="phone" class="label">ì „í™”ë²ˆí˜¸</label>
                            <input id="phone" type="text" class="input" name="phone" placeholder="ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.">
                        </div>

                        <div class="group">
                            <label for="businessname" class="label">ì´ë¦„</label>
                            <input id="businessname" type="text" class="input" name="businessname">
                        </div>

                        <div class="group">
                            <label for="birthyear" class="label">ìƒë…„ì›”ì¼</label>
                            <input id="birthyear" type="date" class="input" name="birthyear">
                        </div>

                        <div class="group">
                            <input type="submit" class="button" value="Sign Up">
                        </div>

                        <div class="hr"></div>
                        <div class="foot-lnk">
                            <label for="tab-1">Already Member?</label>
                        </div>

                    </div>
                </form>

            </div>
        </div>
    </div>
</div>

</body>
</html>
